<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security</title>
    <style>
        body {
            background: black;
            color: white;
        }

        #change-email, #another-email, #change-name {
            cursor: pointer;
            display: none;
        }

        #change-email {
            position: absolute;
            top: 50%;
        }

        #div-change-email-window, #div-change-name-window {
            border: 2px solid white;
            display: none;
        }

        #saveNewName, #saveNewEmail {
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="div-security">

        
        <div id="security-account">
            <span id="main-name">MAIN NAME: </span>
            <span id="main-email">MAIN EMAIL: </span>

            <span id="change-name">CHANGE NAME</span>
            <span id="change-email">CHANGE EMAIL</span>

            <span id="another-email">ANOTHER EMAIL</span>

            
            <div id="div-change-name-window">
                <span id="title">CHANGE NAME</span>

                <input type="text" id="newName" name="name" placeholder="Name">
                <span id="leave">LEAVE</span>
                <span id="saveNewName">SAVE</span>
            </div>

            
            <div id="div-change-email-window">
                <span id="title">CHANGE EMAIL</span>

                <form action="" method="post">

                    <input type="text" id="currentEmail" name="currentEmail" placeholder="Your email">
                    <input type="text" id="newEmail" name="newEmail" placeholder="New email">
                    <input type="text" id="confirmNewEmal" name="confirmNewEmail" placeholder="Confirm the email">
                    <input type="password" name="currentPassword" id="currentPassword" placeholder="Your password">

                </form>

                <span id="leave">LEAVE</span>
                <span id="saveNewEmail">SAVE</span>
            </div>
        </div>


        <div id="security-access-and-login">
            <span id="last-change-password"></span>
            <span id="last-logins"></span>
            <span id="change-password"></span>
            <span id="authentication"></span>
        </div>


        <div id="security-logs">
            <span id="logs"></span>
        </div>


        <div id="log-out">

            <span id="deactivate-account"></span>
            <span id="alert-before-delete"></span>


            <div id="deleteSession">
                <span id="deleteAccount"></span>

                <form action="e" method="post" id="deleteAccountForm">
                    <input type="text" name="emailConfirm" id="emailConfirm" placeholder="Your email" required>
                    <input type="password" name="passwordConfirm" id="passwordConfirm" placeholder="Confirm the password" required>
    
                    <button type="submit">DELETE</button>
                </form>

                <span id="incorrectPassword">Incorrect password</span>
                <span id="incorrectEmail">Incorrect email</span>
                <span id="leaveDeleteAccount">LEAVE</span>
            </div>

        </div>
        

    </div>

    <script src="../Javascript/security.js"></script>
    
    <script>
        let mainEmail = document.getElementById("main-email");
        let changeEmail = document.getElementById("change-email");
        let changeName = document.getElementById("change-name");
        let change = document.getElementById("div-change-name-window")

        const cookieGet = (name) => {
            const test = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'))
            if (test) return test[2];
            return null;
        }

        changeName.addEventListener("click", () => {
            change.style.display = "block";
        });

        changeEmail.addEventListener("click", () => {

        });

        window.addEventListener("DOMContentLoaded", () => {

            console.log("COOKIES: ", document.cookie);
            console.log("oi");
        
            const cookieBase64 = cookieGet("");
            console.log("COOKIE ENCNTRADO: ", cookieBase64)

            if (cookieBase64) {
                try {
                    const test = atob(cookieBase64)
                    const dataWithout = decodeURIComponent(escape(test));
                    const [name, email] = dataWithout.split("|");

                    document.getElementById("main-name").innerHTML = name
                    document.getElementById("main-email").innerText = email

                    console.log("USER NAME: ", name);
                    console.log("USER EMAIL: ", email);

                } catch ( error ) {
                    console.error("ERROR: ", error);
                    alert("SOME ERROR");
                };
            } else {
                console.log("NOTHING");
            };

        });
    </script>
    
</body>
</html>
